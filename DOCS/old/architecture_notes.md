Ниже — пошаговый план, как правильно добавить и настроить модуль в вашей системе так, чтобы он работал через меню, роли и actions (а не через “ручную” вставку в шаблон). Я ориентировался на текущее устройство меню, маршрутизацию action и обработчики в проекте.
Как устроено меню и действия сейчас

    Меню сайдбара строится из данных (переменная $menu) и выводится через templates/cells_NA_sidebar.html. Каждый пункт — это data-core-action для вызова через CoreAPI, а группы и их пункты рисуются циклом. Это означает, что меню “живет” в БД, а шаблон просто отображает переданную структуру.

    Все “экранные действия” обрабатываются через core_api.php, где action мапится на php-обработчик. Новый экран должен иметь свой action в этом роутинге.

    Клик по меню (.js-core-link) отправляет запрос к core_api.php, используя data-core-action. Это видно в обработчике событий CoreAPI на фронте — именно он читает data-core-action и делает запрос.

    Роли/права и меню управляются через roles_permissions_actions.php, который читает menu_groups и menu_items из базы и отдает их в шаблон управления ролями/меню.

Пошагово: как правильно добавить новый модуль (через БД и роли)
Шаг 1. Завести группу меню (если нужна новая секция)

    В таблице menu_groups создать группу (например, tools), задать:

        code, title, icon, sort_order, is_active.

    После этого эта группа будет доступна в UI управления меню (в админке ролей/прав).
    (Данные групп берутся из БД через roles_permissions_actions.php.)

Шаг 2. Добавить пункт меню

    В таблице menu_items создать пункт:

        menu_key (уникальный идентификатор),

        group_code (код группы),

        title,

        icon,

        action (ключевой параметр — именно он вызывает экран),

        sort_order, is_active.

    Пункты меню подгружаются в админке ролей и в боковой панели именно из menu_items.

Шаг 3. Пропиать права

    Создать запись в таблице permissions (например tools_manage).

    В таблице role_permissions связать новое право с нужными ролями.

    На уровне php-обработчика обязательно проверять роль/право (сейчас многие обработчики требуют ADMIN, смотрите начало roles_permissions_actions.php).

Шаг 4. Добавить action в core_api.php

    В www/core_api.php добавить новый action в $routes:

        Например: 'tools_management' => 'api/tools/tools_management_actions.php'.

    Это обязательно, иначе action из меню будет считаться неизвестным и вернется ошибка.

Шаг 5. Создать обработчик action (backend)

    Создать файл api/tools/tools_management_actions.php (или другой).

    В нем:

        проверить права пользователя,

        собрать нужные данные,

        отрендерить HTML-шаблон (например templates/cells_NA_API_tools_management.html),

        вернуть ['status' => 'ok', 'html' => $html].

    Этот HTML будет загружен в основной контент (#main) через CoreAPI.
    (По умолчанию CoreAPI загружает data.html в main.)

Шаг 6. Создать шаблон для экрана

    Создайте файл шаблона (например templates/cells_NA_API_tools_management.html).

    Он будет выводиться в main после запроса action.

    Внутри шаблона уже можно делать вкладки “Перемещение хранения”, “Назначения владельца”, “Отчетность”.

Шаг 7. (Опционально) фронтенд-логика

Если нужны специфические JS-инициализации для экрана:

    Добавьте data-page-init на корневой элемент экрана.

    Зарегистрируйте обработчик в CoreAPI.pageInits (если используется).

    В CoreAPI.ui.loadMain есть вызов pageInits, который активируется при загрузке HTML.

Почему нельзя “втыкать в шаблон напрямую”

Потому что в вашей системе:

    Меню формируется динамически из БД, а шаблон — это только визуализация.

    Переходы внутри панели происходят через data-core-action и core_api.php, а не через прямую разметку.

Итог (что нужно сделать именно для модуля “Инструменты”)

Если хотим “управление инструментами” как отдельный экран:

    menu_groups: проверить/создать группу “Ресурсы” (если уже есть — использовать ее).

    menu_items: добавить пункт, например:

        menu_key=tools_management

        group_code=tools

        title=Управление инструментами

        action=tools_management

    permissions + role_permissions: дать нужным ролям право на доступ.

    core_api.php: добавить маршрут tools_management.

    Создать backend-обработчик api/tools/tools_management_actions.php.

    Создать шаблон templates/cells_NA_API_tools_management.html с нужными вкладками.

