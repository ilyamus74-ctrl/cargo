# cargo

## Структура API
- `www/core_api.php` — основной фасад AJAX-запросов. Принимает `action` и, при необходимости, параметр `domain`, чтобы делегировать выполнение модульным роутерам (например, `domain=devices` перенаправляет в обработчики из `www/api/device_actions.php`).
- `www/api/user_actions.php` — действия, связанные с профилем пользователей.
- `www/api/device_actions.php` — действия для управления устройствами, используемые через доменный роутер.
- `www/bootstrap.php` — базовая инициализация приложения, авторизация, локали и Smarty.

## О проекте
В репозитории находится PHP‑приложение для управления складом/инвентарём и устройствами, а также вспомогательные Android‑клиенты для сканирования/стендов. Веб‑часть построена вокруг собственных PHP‑страниц, JSON‑API и шаблонов Smarty, с локализацией через gettext. Основные сущности, судя по структуре и шаблонам, — пользователи и роли, устройства, инструменты, складские ячейки и приход/перемещение товаров, а также OCR‑обработка данных.

## Архитектура (веб‑часть)
### Точки входа
- `www/index.php` — фронтовой роутер для страниц: определяет путь, требует авторизацию и подключает нужный PHP‑скрипт (например, `main.php`, `login.php`, `prepare_print.php`).【F:www/index.php†L1-L60】
- `www/core_api.php` — JSON‑API роутер для AJAX: принимает `action`, проверяет авторизацию и подключает файл‑обработчик из `www/api/**`.【F:www/core_api.php†L1-L116】
- `www/bootstrap.php` — общая инициализация: сессии и безопасность, локаль/gettext, Smarty и базовые `assign`‑ы для шаблонов.【F:www/bootstrap.php†L1-L99】

### Организация API
API построен на файлах‑обработчиках по доменам:
- `www/api/users/*` — пользователи, роли и права, QR‑логин, настройки профиля и языка.【F:www/core_api.php†L15-L41】
- `www/api/tools/*` — склад инструментов и загрузка фото.【F:www/core_api.php†L45-L52】
- `www/api/devices/*` — устройства и их активация.【F:www/core_api.php†L55-L62】
- `www/api/warehouse/*` — складские ячейки, приход, остатки и перемещения.【F:www/core_api.php†L64-L83】
Дополнительно в `www/api/` есть вспомогательные точки: `core_helpers.php`, `qr_login.php`, `ocr_parse.php`, `stand_measurement_*` и т.д.

### Шаблоны и статические ресурсы
- `templates/` — HTML‑шаблоны Smarty (страницы и частичные блоки). Например: `cells_NA_*` для основного интерфейса, `cells_login.html` и др.
- `templates_c/` — скомпилированные шаблоны Smarty (генерируемая папка).
- `www/assets`, `www/css`, `www/js`, `www/scss`, `www/img` — статические файлы UI.

### Локализация
- `locale/` — gettext‑каталоги для переводов, подключаются в `www/bootstrap.php`.【F:www/bootstrap.php†L33-L65】

### Конфигурация и безопасность
- `configs/secure.php` — запуск сессии, авторизация, роли/права, функции безопасности, подключение к БД.【F:configs/secure.php†L1-L119】
- `configs/connectDB.php` — конфигурация и создание соединения с MySQL (mysqli).【F:configs/connectDB.php†L1-L14】

## Директории и файлы в корне
- `www/` — основное PHP‑веб‑приложение (страницы, API, ресурсы).
- `templates/` — Smarty‑шаблоны, используемые веб‑частью.
- `templates_c/` — скомпилированные шаблоны Smarty (генерируемое).
- `locale/` — файлы локализации.
- `configs/` — настройки безопасности и подключения к БД.
- `libs/` и `src/` — библиотека Smarty и её исходники (рендеринг шаблонов).
- `APP/` — Android‑проекты:
  - `APP/OCRScanner/` — приложение‑сканер (Gradle‑проект).
  - `APP/Stands/` — приложение для стендов (Gradle‑проект).
- `MySqlDump/`, `dumpDB.sh` — дампы и скрипт для работы с БД.
- `wwwocr_samples/` — примеры OCR‑данных/изображений.
- `README/` — вспомогательные материалы/черновики по структуре API (пример рефакторинга).

## Как начать разбираться
1. **Старт с веб‑точки входа:** `www/index.php` и `www/bootstrap.php` дадут понимание маршрутизации и общих зависимостей.【F:www/index.php†L1-L60】【F:www/bootstrap.php†L1-L99】
2. **API‑логика:** посмотрите `www/core_api.php` и соответствующие файлы в `www/api/` для нужного домена (users, tools, devices, warehouse).【F:www/core_api.php†L1-L116】
3. **UI‑шаблоны:** соответствующие шаблоны находятся в `templates/`, а стили/скрипты — в `www/css`, `www/js` и `www/assets`.
4. **Конфиги:** `configs/secure.php` и `configs/connectDB.php` задают сессию/авторизацию и подключение к БД.【F:configs/secure.php†L1-L119】【F:configs/connectDB.php†L1-L14】

## Быстрый smoke‑проверочный прогон (опционально)
- Проверка синтаксиса основных точек входа: `php -l www/index.php` и `php -l www/core_api.php`.
- Для API‑запросов можно отправлять `action` в `www/core_api.php` (см. маппинг в файле).【F:www/core_api.php†L15-L83】