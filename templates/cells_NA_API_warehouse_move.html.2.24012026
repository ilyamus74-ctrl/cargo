    <div class="pagetitle">
      <h1>Warehouse Move</h1>
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="index.html">Main</a></li>
          <li class="breadcrumb-item">Warehouse</li>
          <li class="breadcrumb-item active">Перемещение</li>
        </ol>
      </nav>
    </div><!-- End Page Title -->

    <section class="section">
      <div class="row">
        <div class="col-lg-6">
          <div class="card table-responsive warehouse-move-wrapper">
            <div class="card-body">
              <h5 class="card-title">Перемещение</h5>

              <ul class="nav nav-tabs d-flex" id="warehouseMoveTabs" role="tablist">
                <li class="nav-item flex-fill" role="presentation">
                  <button class="nav-link w-100 active" id="warehouse-move-scanner-tab" data-bs-toggle="tab" data-bs-target="#warehouse-move-scanner" type="button" role="tab" aria-controls="warehouse-move-scanner" aria-selected="true">
                    Сканнер перемещение
                  </button>
                </li>
                <li class="nav-item flex-fill" role="presentation">
                  <button class="nav-link w-100" id="warehouse-move-batch-tab" data-bs-toggle="tab" data-bs-target="#warehouse-move-batch" type="button" role="tab" aria-controls="warehouse-move-batch" aria-selected="false" tabindex="-1">
                    Пакетное перемещение
                  </button>
                </li>
              </ul>

              <div class="tab-content pt-3" id="warehouseMoveTabsContent">
                <div class="tab-pane fade show active" id="warehouse-move-scanner" role="tabpanel" aria-labelledby="warehouse-move-scanner-tab">
                  <p class="text-muted mb-1">Введите или отсканируйте TUID/трек-номер для поиска.</p>
                  <small class="text-muted">Цель: присвоение новых значений <code>warehouse_item_stock.cell_id</code> для товаров на складе.</small>


                  <div class="row g-2 align-items-end mt-3">
                    <div class="col-12 col-md-8">
                      <label class="form-label small mb-1" for="warehouse-move-search">Поиск</label>
                      <input type="text" id="warehouse-move-search" class="form-control form-control-sm" placeholder="TUID или трек-номер">
                    </div>
                  </div>

                  <p class="small text-muted mb-2 mt-3">
                    Найдено: <span id="warehouse-move-total">0</span>
                  </p>

                  <div class="table-responsive">
                    <table class="table table-sm align-middle users-table">
                      <thead>
                        <tr>
                          <th scope="col">Посылка</th>
                          <th scope="col">Источник</th>
                          <th scope="col">Ячейка</th>
                          {if $current_user.role == 'ADMIN'}
                            <th scope="col">Пользователь</th>
                          {/if}
                          <th scope="col">Дата</th>
                        </tr>
                      </thead>
                      <tbody id="warehouse-move-results-tbody"></tbody>
                    </table>
                  </div>
                </div>
                <div class="tab-pane fade" id="warehouse-move-batch" role="tabpanel" aria-labelledby="warehouse-move-batch-tab">
                  <p class="text-muted mb-1">Выберите ячейку и добавляйте посылки по трек-номеру.</p>
                  <small class="text-muted">Цель: пакетное присвоение новых значений <code>warehouse_item_stock.cell_id</code>.</small>

                  <div class="row g-2 align-items-end mt-3">
                    <div class="col-12 col-md-5">
                      <label class="form-label small mb-1" for="warehouse-move-batch-cell">Ячейка склада</label>
                      <select class="form-select form-select-sm" id="warehouse-move-batch-cell">
                        <option value="">— выберите ячейку —</option>
                        {foreach $cells as $cell}
                          <option value="{$cell.id|escape}">{$cell.code|escape}</option>
                        {/foreach}
                      </select>
                    </div>
                    <div class="col-12 col-md-7">
                      <label class="form-label small mb-1" for="warehouse-move-batch-search">Трек-номер</label>
                      <input type="text" id="warehouse-move-batch-search" class="form-control form-control-sm" placeholder="TUID или трек-номер">
                    </div>
                  </div>

                  <p class="small text-muted mb-2 mt-3">
                    Найдено: <span id="warehouse-move-batch-total">0</span>
                  </p>

                  <div class="table-responsive">
                    <table class="table table-sm align-middle users-table">
                      <thead>
                        <tr>
                          <th scope="col">Посылка</th>
                          <th scope="col">Источник</th>
                          <th scope="col">Ячейка</th>
                          <th scope="col">Переместить</th>
                          {if $current_user.role == 'ADMIN'}
                            <th scope="col">Пользователь</th>
                          {/if}
                          <th scope="col">Дата</th>
                        </tr>
                      </thead>
                      <tbody id="warehouse-move-batch-results-tbody"></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
{literal}
<script id="device-scan-config" type="application/json">
{
  "task_id":"warehouse_move",
  "default_mode":"barcode",
  "modes":["barcode","qr"],

  "buttons":{
    "vol_down_single":"scan",
    "vol_down_double":"confirm",
    "vol_up_single":"clear",
    "vol_up_double":"reset"
  },

  "api": {
    "move_apply": "/api/warehouse_move_apply.php"
  },

  "contexts": {
    "scanner": {
      "active_tab_selector": "#warehouse-move-scanner-tab.nav-link.active",
      "barcode": { "action":"fill_field", "field_id":"warehouse-move-search" },
      "qr":      { "action":"api_check", "endpoint":"/api/qr_check.php" }
    },

    "batch": {
      "active_tab_selector": "#warehouse-move-batch-tab.nav-link.active",
      "barcode": { "action":"fill_field", "field_id":"warehouse-move-search" },
      "qr":      {
        "action":"api_check",
        "endpoint":"/api/qr_check.php",
        "apply_to_select_id":"warehouse-move-cell-select"
      }
    }
  },

  "flow":{
    "start":"scan_parcel",
    "steps":{
      "scan_parcel":{
        "next_on_scan":"scan_from_cell",
        "on_action":{
          "scan":[{"op":"open_scanner","mode":"barcode"}],
          "confirm":[{"op":"noop"}],
          "clear":[{"op":"noop"}],
          "reset":[{"op":"noop"}]
        }
      },
      "scan_from_cell":{
        "next_on_scan":"scan_to_cell",
        "on_action":{
          "scan":[{"op":"open_scanner","mode":"qr"}],
          "confirm":[{"op":"noop"}],
          "clear":[{"op":"noop"}],
          "reset":[{"op":"noop"}]
        }
      },
      "scan_to_cell":{
        "on_action":{
          "scan":[{"op":"open_scanner","mode":"qr"}],
          "confirm":[{"op":"noop"}],
          "clear":[{"op":"noop"}],
          "reset":[{"op":"noop"}]
        }
      }
    }
  }
}
</script>
{/literal}



<div id="ocr-templates" style="display:none">
    {$jsonOcrTemplates}
</div>
<div id="ocr-templates-destcountry" style="display:none">
    {$jsonDestCountry}
</div>

<div id="ocr-dicts" style="display:none">
    {$jsonOcrDicts}
</div>

    <!-- Full Screen Modal -->
    <div class="modal fade" id="fullscreenModal" tabindex="-1">
      <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">

          <div class="modal-header">
            <h5 class="modal-title">Просмотр посылки</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            Загрузка...
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div><!-- End Full Screen Modal-->
