www/APP/MainActivity.kt
теперь вопрос по программе. сам сканнер испольщует шаблон по сканированию.
пример:
читает скрытый елемент
<script id="device-scan-config" type="application/json">
{
  "task_id": "warehouse_in",
  "default_mode": "ocr",
  "modes": ["ocr"],
  "barcode": { "action": "fill_field", "field_id": "trackingNo" },
  "qr":      { "action": "api_check",  "endpoint": "/api/qr_check.php" }
}
</script>
и по нему уже работает.
первый скан в поле трек номер
второй скан расстовляет поля .
все верно?
смысл был таков что бы задавть простой алгоритм сканирования через шаблоны которые доступны в определенных страницах или попапах.
если не верно то подскади как жто исправить
шаблон + апп

Как работает текущий шаблон

    В WebView инжектируется JS INSTALL_MAIN_OBSERVER_JS, который читает содержимое скрытых элементов device-scan-config, ocr-templates, ocr-templates-destcountry и передаёт JSON в приложение через DeviceApp.onMainContext. Именно из этого блока берётся ваш пример-конфиг с task_id, default_mode, modes, barcode и qr.

Когда приходит новый контекст страницы, JSON из device-scan-config разбирается в ScanTaskConfig (есть поля defaultMode, список modes, а для штрихкода/QR — ScanAction с action, field_id/field_name, endpoint).

Для задачи warehouse_in включён пошаговый поток:

    сначала шаг BARCODE; аппаратная кнопка запускает оверлей штрихкода; после успешного скана вызывается fillBarcodeUsingTemplate, который, если action в шаблоне fill_field, заполняет указанное поле (field_id/field_name) в форме и параллельно подставляет данные, извлечённые из штрихкода; затем шаг меняется на OCR.

    на шаге OCR открывается оверлей распознавания текста, и результатом заполняются остальные поля формы; после этого шаг становится SUBMIT.

    при следующем нажатии «Громкость вниз» на шаге SUBMIT форма подготавливается к новому скану и цикл повторяется с BARCODE.

Ответ на ваш вопрос

    Да, при шаблоне из примера логика такая: первый скан — штрихкод (поле трек-номера заполняется через barcode.action=fill_field), второй — OCR, который расставляет остальные поля. QR-шаблон (qr.action) будет отрабатывать, только если default_mode/modes выбирают QR или вы инициируете QR-скан вручную. Если хотите изменить порядок (например, начинать с QR или сразу с OCR), корректируйте default_mode и modes в device-scan-config, а для автозаполнения других полей — настраивайте barcode/ocr действия и соответствующий JS/серверный обработчик.

Если нужно поправить поведение

    Убедитесь, что в шаблоне для warehouse_in прописан barcode: { "action": "fill_field", "field_id": "trackingNo" } и что default_mode стоит ocr (или нужный вам порядок). Тогда поток будет: штрихкод → OCR → подготовка к следующему скану, как описано выше.

